
<!DOCTYPE html>

<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<title>Programação Fribon Rota MT</title>
<style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; padding: 20px; display: flex; justify-content: center; }
    .container { max-width: 1000px; width: 100%; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px #ccc; }
    h1 { text-align: center; margin-bottom: 20px; }
    .usina-box { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .usina-box input { padding: 6px; border-radius: 6px; border: 1px solid #ccc; width: 250px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #007bff; color: white; }
    input[type=text], select {
      padding: 6px;
      width: 95%;
      max-width: 160px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .dia { margin-bottom: 40px; background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px #ccc; }
  </style>
</head>
<body>
<div class="container">
<h1>Programação Fribon Rota MT</h1>

<div style="display: flex; justify-content: center; gap: 12px; margin-bottom: 20px;">
<input id="buscaPlaca" placeholder="Buscar por placa" style="padding: 6px; border-radius: 8px; border: 1px solid #ccc; width: 200px;" type="text"/>
<input id="buscaData" style="padding: 6px; border-radius: 8px; border: 1px solid #ccc;" type="date"/>
</div>
<script>
document.getElementById("buscaPlaca").addEventListener("input", function() {
  const placa = this.value.toLowerCase();
  document.querySelectorAll(".dia").forEach(dia => {
    let visivel = false;
    dia.querySelectorAll("tbody tr").forEach(tr => {
      const valor = tr.querySelector("input")?.value.toLowerCase();
      if (valor && valor.includes(placa)) {
        tr.style.display = "";
        visivel = true;
      } else {
        tr.style.display = "none";
      }
    });
    dia.style.display = placa ? (visivel ? "" : "none") : "";
  });
});

document.getElementById("buscaData").addEventListener("change", function() {
  const dataBusca = this.value;
  document.querySelectorAll(".dia").forEach(dia => {
    const data = dia.querySelector("h2")?.innerText.split(" - ")[1];
    dia.style.display = data === dataBusca ? "" : "none";
  });
});
</script>
<div id="dias-container"></div>
</div>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBZIXu29xTIyiRqbQQb03wSuYsUubtrZs0",
      authDomain: "programacao-app.firebaseapp.com",
      databaseURL: "https://programacao-app-default-rtdb.firebaseio.com",
      projectId: "programacao-app",
      storageBucket: "programacao-app.appspot.com",
      messagingSenderId: "275009784554",
      appId: "1:275009784554:web:c7d6c804993e02af55e593"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const diasSemana = ["Domingo", "Segunda-feira", "Terça-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "Sábado"];
    const statusOptions = ["", "AGENDADO", "AGUARDANDO COTA", "PROGRAMADO", "COMPROVANTE", "ANEXADO"];
    const usinas = ["", "FS LUCAS", "FS SORRISO", "INPASA MUTUM", "INPASA SINOP"];

    function gerarSemana() {
      const container = document.getElementById("dias-container");
      container.innerHTML = "";
      const hoje = new Date();

      for (let d = 0; d < 7; d++) {
        const dataAtual = new Date();
        dataAtual.setDate(hoje.getDate() + d);
        const nomeDia = diasSemana[dataAtual.getDay()];
        const dataFormatada = dataAtual.toISOString().split("T")[0];
        const idDia = `${dataFormatada}`;

        const bloco = document.createElement("div");
        bloco.className = "dia";
        bloco.innerHTML = `<h2>${nomeDia} - ${dataFormatada}</h2>`;

        for (let u = 1; u <= 2; u++) {
          const usinaId = `usina${u}`;
          const usinaBox = document.createElement("div");
          usinaBox.className = "usina-box";

          const input = document.createElement("input");
          input.placeholder = "Selecionar ou digitar usina";
          input.setAttribute("list", "usinas");
          input.className = "input-usina";

          const contador = document.createElement("span");
          contador.className = "contador";
          contador.innerText = "0 caminhões (0 m³)";

          usinaBox.appendChild(input);
          usinaBox.appendChild(contador);
          bloco.appendChild(usinaBox);

          const tabela = document.createElement("table");
          tabela.innerHTML = `
            <thead><tr><th>Placa</th><th>Empresa</th><th>Status</th></tr></thead>
            <tbody>
              ${[...Array(10)].map(() => `
                <tr>
                  <td><input type="text"></td>
                  <td><input type="text"></td>
                  <td><select>${statusOptions.map(s => `<option value="${s}">${s}</option>`).join("")}</select></td>
                </tr>`).join("")}
            </tbody>
          `;
          bloco.appendChild(tabela);
        }

        container.appendChild(bloco);
      }

      carregarFirebase();
    }

    function salvarFirebase() {
      const dias = document.querySelectorAll(".dia");
      dias.forEach(dia => {
        const titulo = dia.querySelector("h2").innerText;
        const data = titulo.split(" - ")[1];
        const usinas = dia.querySelectorAll(".usina-box");
        const linhas = dia.querySelectorAll("tbody tr");

        const dados = {
          usinas: [...usinas].map(u => u.querySelector("input").value),
          linhas: [...linhas].map(tr => [...tr.querySelectorAll("input, select")].map(el => el.value))
        };

        set(ref(db, "programacao/" + data), dados);
      });
    }

    function carregarFirebase() {
      const dias = document.querySelectorAll(".dia");
      dias.forEach(dia => {
        const titulo = dia.querySelector("h2").innerText;
        const data = titulo.split(" - ")[1];

        get(child(ref(db), "programacao/" + data)).then(snapshot => {
          if (snapshot.exists()) {
            const dataSalva = snapshot.val();
            const usinas = dia.querySelectorAll(".usina-box input");
            dataSalva.usinas?.forEach((val, i) => { if (usinas[i]) usinas[i].value = val });

            const linhas = dia.querySelectorAll("tbody tr");
            dataSalva.linhas?.forEach((linha, i) => {
              const campos = linhas[i]?.querySelectorAll("input, select") || [];
              linha.forEach((valor, j) => {
                if (campos[j]) campos[j].value = valor;
              });
            });

            atualizarTotais();
          }
        });
      });
    }

    function atualizarTotais() {
      document.querySelectorAll(".dia").forEach(dia => {
        dia.querySelectorAll(".usina-box").forEach(usinaBox => {
          const tabela = usinaBox.nextElementSibling;
          const placas = [...tabela.querySelectorAll("tbody tr")];
          const placasPreenchidas = placas.filter(tr => tr.children[0].querySelector("input").value.trim() !== "");
          const count = placasPreenchidas.length;
          const volume = count * 62;
          const contador = usinaBox.querySelector(".contador");
          contador.innerText = `${count} caminhões (${volume} m³)`;
        });
      });
    }

    setInterval(salvarFirebase, 5000);
    setInterval(atualizarTotais, 3000);
    window.onload = gerarSemana;
  </script>
<datalist id="usinas">
    ${usinas.map(u =&gt; `<option value="${u}">`).join("")}
  </option></datalist>
</body>
</html>

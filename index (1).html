<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Programação Fribon Rota MT</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
  "apiKey": "AIzaSyCIJUaoLxzeuNlQYqsNFa-YBHHfN0vcc6g",
  "authDomain": "programacao-fribon-6de02.firebaseapp.com",
  "databaseURL": "https://programacao-fribon-6de02-default-rtdb.firebaseio.com",
  "projectId": "programacao-fribon-6de02",
  "storageBucket": "programacao-fribon-6de02.firebasestorage.app",
  "messagingSenderId": "590383729232",
  "appId": "1:590383729232:web:49613653335c46b466df55"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const statusOptions = ["", "Programado", "Agendado", "Pendente Comprovante", "Anexado", "Aguardando Cota"];
    const colors = {
      "Programado": "#e0e0e0",
      "Agendado": "#d1ffd1",
      "Pendente Comprovante": "#fff5cc",
      "Anexado": "#cce5ff",
      "Aguardando Cota": "#ffd1d1"
    };

    function updateRowColor(select) {
      const row = select.closest('tr');
      const value = select.value;
      row.style.backgroundColor = colors[value] || "";
    }

    function gerarSemana() {
      const diasSemana = ["Domingo", "Segunda-feira", "Terça-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "Sábado"];
      const container = document.getElementById("dias-container");
      container.innerHTML = "";
      const hoje = new Date();

      for (let d = 0; d < 7; d++) {
        const dataAtual = new Date();
        dataAtual.setDate(hoje.getDate() + d);
        const nomeDia = diasSemana[dataAtual.getDay()];
        const dataFormatada = dataAtual.toISOString().slice(0, 10);

        const bloco = document.createElement("div");
        bloco.className = "dia";
        bloco.innerHTML = `<h2>${nomeDia} - ${dataFormatada}</h2>`;

        for (let usina = 1; usina <= 2; usina++) {
          const usinaBox = document.createElement("div");
          usinaBox.className = "usina-box";

          const label = document.createElement("label");
          label.textContent = `Usina ${usina}`;
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = "Selecionar ou digitar usina";

          const contador = document.createElement("span");
          contador.style = "font-weight:bold; margin-left:10px";

          usinaBox.appendChild(label);
          usinaBox.appendChild(input);
          usinaBox.appendChild(contador);
          bloco.appendChild(usinaBox);

          const tabela = document.createElement("table");
          tabela.innerHTML = `
            <thead><tr><th>Placa</th><th>Empresa</th><th>Status</th></tr></thead>
            <tbody>
              ${[...Array(10)].map(() => `
                <tr>
                  <td><input type="text"></td>
                  <td><input type="text"></td>
                  <td>
                    <select>
                      ${statusOptions.map(s => `<option value="${s}">${s}</option>`).join("")}
                    </select>
                  </td>
                </tr>`).join("")}
            </tbody>
          `;
          bloco.appendChild(tabela);
        }

        container.appendChild(bloco);
      }
      carregarFirebase();
    }

    function enviarFirebase() {
      const blocos = document.querySelectorAll(".dia");
      const dados = {};

      blocos.forEach((bloco) => {
        const data = bloco.querySelector("h2").innerText.split(" - ")[1];
        dados[data] = { usinas: [], linhas: [] };

        const usinas = bloco.querySelectorAll(".usina-box input");
        usinas.forEach(u => dados[data].usinas.push(u.value));

        const linhas = bloco.querySelectorAll("table tbody tr");
        linhas.forEach(tr => {
          const inputs = tr.querySelectorAll("input, select");
          dados[data].linhas.push(Array.from(inputs).map(i => i.value));
        });
      });

      set(ref(db, "programacao"), dados);
    }

    function carregarFirebase() {
      get(child(ref(db), "programacao")).then(snapshot => {
        const dados = snapshot.val() || {};
        const blocos = document.querySelectorAll(".dia");

        blocos.forEach(bloco => {
          const data = bloco.querySelector("h2").innerText.split(" - ")[1];
          const dadoDia = dados[data];

          if (!dadoDia) return;

          const usinas = bloco.querySelectorAll(".usina-box input");
          dadoDia.usinas.forEach((val, i) => { if (usinas[i]) usinas[i].value = val });

          const linhas = bloco.querySelectorAll("table tbody tr");
          dadoDia.linhas.forEach((linha, i) => {
            const campos = linhas[i]?.querySelectorAll("input, select") || [];
            linha.forEach((valor, j) => {
              if (campos[j]) {
                campos[j].value = valor;
                if (campos[j].tagName === "SELECT") updateRowColor(campos[j]);
              }
            });
          });
        });
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      gerarSemana();
      setTimeout(() => {
        document.querySelectorAll("input, select").forEach(el => {
          el.addEventListener("input", enviarFirebase);
          el.addEventListener("change", enviarFirebase);
        });
      }, 1000);
    });
  </script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; padding: 20px; display: flex; justify-content: center; }
    .container { max-width: 1000px; width: 100%; }
    h1 { text-align: center; margin-bottom: 20px; }
    .usina-box { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .usina-box input { width: 300px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #007bff; color: white; }
    input[type=text], select {
      padding: 6px;
      width: 95%;
      max-width: 160px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .dia { margin-bottom: 40px; background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px #ccc; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Programação Fribon Rota MT</h1>
    <div id="dias-container"></div>
  </div>
</body>
</html>
